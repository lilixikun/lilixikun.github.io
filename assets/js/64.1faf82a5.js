(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{414:function(t,s,a){"use strict";a.r(s);var n=a(25),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"pm2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2"}},[t._v("#")]),t._v(" PM2")]),t._v(" "),a("p",[t._v("PM2 æ˜¯ node è¿›ç¨‹ç®¡ç†å·¥å…·ï¼Œå¯ä»¥åˆ©ç”¨å®ƒæ¥ç®€åŒ–å¾ˆå¤šnodeåº”ç”¨ç®¡ç†çš„ç¹çä»»åŠ¡ï¼Œå¦‚æ€§èƒ½ç›‘æ§ã€è‡ªåŠ¨é‡å¯ã€è´Ÿè½½ å‡è¡¡ç­‰ï¼Œè€Œä¸”ä½¿ç”¨éå¸¸ç®€å•ã€‚")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://pm2.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("pm2å®˜ç½‘"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"åˆ›å»ºè¿›ç¨‹çš„æ–¹æ³•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åˆ›å»ºè¿›ç¨‹çš„æ–¹æ³•"}},[t._v("#")]),t._v(" åˆ›å»ºè¿›ç¨‹çš„æ–¹æ³•")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("fork")])]),t._v(" "),a("li",[a("strong",[t._v("exec")])])]),t._v(" "),a("h2",{attrs:{id:"pm2åŸç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pm2åŸç†"}},[t._v("#")]),t._v(" pm2åŸç†")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// master")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" cluster "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cluster'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" numCPUs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'os'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cpus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isMaster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("numCPUs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" numCPUs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" worker "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("fork")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"./app.js"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// worker")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" http "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nhttp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("writeHead")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("end")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"hello world\\n"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("pm2 ä¼šæ ¹æ®ç”µè„‘çš„ cpus ä¸ªæ•°å» fork å¯¹åº”çš„è¿›ç¨‹æ•°ï¼ŒNode å¤šè¿›æˆé»˜è®¤ä¼šé‡‡ç”¨æŠ¢å ç­–ç•¥ã€‚")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("ç–‘é—®ğŸ¤”ï¸")]),t._v(" "),a("p",[t._v("å¦‚ä½•æ£€æµ‹å­è¿›ç¨‹æ˜¯å¦å¤„äºæ­£å¸¸æ´»è·ƒçŠ¶æ€ï¼Ÿ")])]),t._v(" "),a("p",[a("strong",[t._v("é‡‡ç”¨å¿ƒè·³æ£€æµ‹")]),t._v("ï¼Œæ¯éš”æ•°ç§’å‘å­è¿›ç¨‹å‘é€å¿ƒè·³åŒ…ï¼Œå­è¿›ç¨‹å¦‚æœä¸å›å¤ï¼Œé‚£ä¹ˆè°ƒç”¨killæ€æ­»è¿™ä¸ªè¿›ç¨‹\nç„¶åå†é‡æ–° "),a("strong",[t._v("cluster.fork()")]),t._v(" ä¸€ä¸ªæ–°çš„è¿›ç¨‹")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("ç–‘é—®ğŸ¤”ï¸")]),t._v(" "),a("p",[t._v("å­è¿›ç¨‹å‘å‡ºå¼‚å¸¸æŠ¥é”™ï¼Œå¦‚ä½•ä¿è¯ä¸€ç›´æœ‰ä¸€å®šæ•°é‡å­è¿›ç¨‹ï¼Ÿ")])]),t._v(" "),a("p",[t._v("å­è¿›ç¨‹å¯ä»¥ç›‘å¬åˆ°é”™è¯¯äº‹ä»¶ï¼Œè¿™æ—¶å€™å¯ä»¥å‘é€æ¶ˆæ¯ç»™ä¸»è¿›ç¨‹ï¼Œè¯·æ±‚æ€æ­»è‡ªå·±\nå¹¶ä¸”ä¸»è¿›ç¨‹æ­¤æ—¶é‡æ–°è°ƒç”¨ "),a("strong",[t._v("cluster.fork")]),t._v(" ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬å¯ä»¥ä¾èµ– "),a("strong",[t._v("Nginx")]),t._v("+"),a("strong",[t._v("pm2")]),t._v("+"),a("strong",[t._v("docker")]),t._v("æ¥å®ç°è‡ªåŠ¨åŒ–+ç›‘æ§éƒ¨ç½²ï¼Œ")])])}),[],!1,null,null,null);s.default=r.exports}}]);